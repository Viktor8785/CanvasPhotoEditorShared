const photoInput=document.querySelector(".photo__input"),photo=document.querySelector(".photo__img"),closeButton=document.querySelector(".close-button"),contrastButton=document.querySelector("#contrast-button"),brightnessButton=document.querySelector("#brightness-button"),saturateButton=document.querySelector("#saturate-button"),grayButton=document.querySelector("#gray-button"),sepiaButton=document.querySelector("#sepia-button"),blurButton=document.querySelector("#blur-button"),saveButton=document.querySelector("#save-button"),rangeInput=document.querySelector(".range__input"),footerItem=document.querySelectorAll(".footer__item"),backButton=document.querySelector("#back-button");var canvas=document.createElement("canvas"),ctx=canvas.getContext("2d",{willReadFrequently:!0}),image=new Image;let photoChanged=!1,filterName="",currentItem=0,filterComposit="";rangeInput.disabled=!0,photoInput.addEventListener("change",(()=>{let t=photoInput.files[0],e=new FileReader;e.addEventListener("load",(()=>{image.src=e.result,photo.src=e.result})),e.readAsDataURL(t),photo.classList.add("photo__img--active"),closeButton.classList.add("close-button--active")})),closeButton.addEventListener("click",(()=>{photoChanged=!1,rangeInput.value=15,rangeInput.disabled=!0,photo.classList.remove("photo__img--active"),closeButton.classList.remove("close-button--active"),footerItem[currentItem].classList.remove("footer__item--active")})),backButton.addEventListener("click",(()=>{backFilter(),photo.style.filter=filterComposit,footerItem[currentItem].classList.remove("footer__item--active"),currentItem=0,rangeInput.value=15,rangeInput.disabled=!0,filterName=""})),contrastButton.addEventListener("click",(()=>{photo.classList.contains("photo__img--active")&&(footerItem[currentItem].classList.remove("footer__item--active"),currentItem=0,footerItem[currentItem].classList.add("footer__item--active"),rangeInput.disabled=!1,photoChanged=!0,changeFilter(rangeInput.value),filterName="contrast",rangeInput.value=15)})),brightnessButton.addEventListener("click",(()=>{photo.classList.contains("photo__img--active")&&(footerItem[currentItem].classList.remove("footer__item--active"),currentItem=1,footerItem[currentItem].classList.add("footer__item--active"),rangeInput.disabled=!1,photoChanged=!0,changeFilter(rangeInput.value),filterName="brightness",rangeInput.value=15)})),saturateButton.addEventListener("click",(()=>{photo.classList.contains("photo__img--active")&&(footerItem[currentItem].classList.remove("footer__item--active"),currentItem=2,footerItem[currentItem].classList.add("footer__item--active"),rangeInput.disabled=!1,photoChanged=!0,changeFilter(rangeInput.value),filterName="saturate",rangeInput.value=15)})),grayButton.addEventListener("click",(()=>{photo.classList.contains("photo__img--active")&&(footerItem[currentItem].classList.remove("footer__item--active"),currentItem=3,footerItem[currentItem].classList.add("footer__item--active"),rangeInput.disabled=!1,photoChanged=!0,changeFilter(rangeInput.value),filterName="grayscale",rangeInput.value=0)})),sepiaButton.addEventListener("click",(()=>{photo.classList.contains("photo__img--active")&&(footerItem[currentItem].classList.remove("footer__item--active"),currentItem=4,footerItem[currentItem].classList.add("footer__item--active"),rangeInput.disabled=!1,photoChanged=!0,changeFilter(rangeInput.value),filterName="sepia",rangeInput.value=0)})),blurButton.addEventListener("click",(()=>{photo.classList.contains("photo__img--active")&&(footerItem[currentItem].classList.remove("footer__item--active"),currentItem=5,footerItem[currentItem].classList.add("footer__item--active"),rangeInput.disabled=!1,photoChanged=!0,changeFilter(rangeInput.value),filterName="blur",rangeInput.value=0)})),saveButton.addEventListener("click",(t=>{if(!photoChanged)return void t.preventDefault();footerItem[currentItem].classList.remove("footer__item--active"),currentItem=0,canvas.width=image.width,canvas.height=image.height,ctx.drawImage(image,0,0),changeCanvas(rangeInput.value),ctx.drawImage(image,0,0);const e=ctx.getImageData(0,0,canvas.width,canvas.height);ctx.putImageData(e,0,0);var o=canvas.toDataURL("image/jpeg");saveButton.href=o,saveButton.download="canvas_photo_editor_1.jpg"})),rangeInput.addEventListener("input",(t=>{changePhoto(rangeInput.value)}));let changePhoto=function(t){filterName&&("contrast"==filterName&&(photo.style.filter=filterComposit+" contrast("+t/15+")"),"brightness"==filterName&&(photo.style.filter=filterComposit+" brightness("+t/15+")"),"saturate"==filterName&&(photo.style.filter=filterComposit+" saturate("+t/15+")"),"grayscale"==filterName&&(photo.style.filter=filterComposit+" grayscale("+t/30+")"),"sepia"==filterName&&(photo.style.filter=filterComposit+" sepia("+t/30+")"),"blur"==filterName&&(photo.style.filter=filterComposit+" blur("+t/3+"px)"))},changeCanvas=function(t){(filterName||filterComposit)&&(filterComposit&&(ctx.filter=filterComposit),"contrast"==filterName&&(ctx.filter=filterComposit+" contrast("+t/15+")"),"brightness"==filterName&&(ctx.filter=filterComposit+" brightness("+t/15+")"),"saturate"==filterName&&(ctx.filter=filterComposit+" saturate("+t/15+")"),"grayscale"==filterName&&(ctx.filter=filterComposit+" grayscale("+t/30+")"),"sepia"==filterName&&(ctx.filter=filterComposit+" sepia("+t/30+")"),"blur"==filterName&&(ctx.filter=filterComposit+" blur("+t/3+"px)"))},changeFilter=function(t){filterName&&("contrast"==filterName&&(filterComposit=filterComposit+" contrast("+t/15+")"),"brightness"==filterName&&(filterComposit=filterComposit+" brightness("+t/15+")"),"saturate"==filterName&&(filterComposit=filterComposit+" saturate("+t/15+")"),"grayscale"==filterName&&(filterComposit=filterComposit+" grayscale("+t/30+")"),"sepia"==filterName&&(filterComposit=filterComposit+" sepia("+t/30+")"),"blur"==filterName&&(filterComposit=filterComposit+" blur("+t/3+"px)"))},backFilter=function(){if(filterComposit){let t=filterComposit.lastIndexOf(" ");filterComposit=filterComposit.slice(0,t)}};